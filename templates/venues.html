<html>
    <head>
        <title>Venues</title>
        <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    
        <style>
/*
 * Always set the map height explicitly to define the size of the div element
 * that contains the map.
 */
#map {
  height: 100%;
}

/*
 * Optional: Makes the sample page fill the window.
 */
html,
body {
  height: 100%;
  margin: 0;
  padding: 0;
}
        </style>
    </head>
    <body>
        <h3>My Google Maps Demo</h3>
        <!--The div element for the map -->
        <div id="map"></div>
    
        <!-- prettier-ignore -->
        <script>(g=>{var h,a,k,p="The Google Maps JavaScript API",c="google",l="importLibrary",q="__ib__",m=document,b=window;b=b[c]||(b[c]={});var d=b.maps||(b.maps={}),r=new Set,e=new URLSearchParams,u=()=>h||(h=new Promise(async(f,n)=>{await (a=m.createElement("script"));e.set("libraries",[...r]+"");for(k in g)e.set(k.replace(/[A-Z]/g,t=>"_"+t[0].toLowerCase()),g[k]);e.set("callback",c+".maps."+q);a.src=`https://maps.${c}apis.com/maps/api/js?`+e;d[q]=f;a.onerror=()=>h=n(Error(p+" could not load."));a.nonce=m.querySelector("script[nonce]")?.nonce||"";m.head.append(a)}));d[l]?console.warn(p+" only loads once. Ignoring:",g):d[l]=(f,...n)=>r.add(f)&&u().then(()=>d[l](f,...n))})
            // TODO: restrict
            ({key: "AIzaSyAKtI3oQrz29NbD9oNTjx3oH-Y6kPmstsI", v: "beta"});</script>
        <script type="text/javascript">
// Initialize and add the map
let map;

function get_icon_url(network_name) {
    if (network_name == 'VUE') {
        return "https://www.myvue.com/assets/images/favicons/favicon-16x16.png";
    }
    if (network_name == 'Cineworld') {
        return "https://cdn-ukwest.onetrust.com/logos/5922c8a7-c44a-4864-9773-804dd97f3b15/7c48a274-41fc-453d-b9bc-d85ef8a94818/7e230523-a961-4471-8d41-c62faa657010/CWicon.png";
        //return "https://www.cineworld.co.uk/xmedia/img/10108/fav.png?";
    }
    if (network_name == 'ODEON') {
        return "https://www.odeon.co.uk/images/favicon.png";
    }
    if (network_name == 'Everyman') {
        return "https://cms-assets.webediamovies.pro/cdn-cgi/image/width=192,height=192,fit=contain,quality=100/production/2/d757bf555569b234393e995da3b1d4cb.png";
    }
    if (network_name == 'Curzon') {
        return "https://www.curzon.com/frontend/build/img/favicon.png";
    }
    if (network_name == 'Picturehouse') {
        return "https://www.picturehouses.com/themes/images/favicon-16x16.png";
    }
    if (network_name == 'Electric Cinema') {
        return "https://www.electriccinema.co.uk/favicon-16x16.png";
    }
    if (network_name == "BFI") {
        return "https://upload.wikimedia.org/wikipedia/en/5/5a/British_Film_Institute_logo.svg"
    }
    return null;
}

async function initMap() {
  // The location of Uluru
  const position = { lat: 54.0, lng: -5.0 };
  // Request needed libraries.
  //@ts-ignore
  const { Map } = await google.maps.importLibrary("maps");
  const { AdvancedMarkerView } = await google.maps.importLibrary("marker");

  // The map, centered at Uluru
  map = new Map(document.getElementById("map"), {
    zoom: 6,
    center: position,
    mapId: "DEMO_MAP_ID",
  });

  var markers = [];
  var icons = [];
  {% for venue in venues %}
    var icon_url = get_icon_url("{{ venue.network_name }}");
    var icon = null;
    if (icon_url != null) {
        icons.push(document.createElement("img"));
        icon = icons[icons.length - 1];
        icon.width = 20;
        icon.src = icon_url;
    }
    markers.push(new AdvancedMarkerView({
        map: map,
        position: { lat: {{ venue.lat }}, lng: {{ venue.lon }}},
        title: "{{ venue.network_name }} - {{ venue.name }}",
        content: icon,
    }));
  {% endfor %}
}

initMap();
        </script>
    </body>
</html>
